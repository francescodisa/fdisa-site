<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Artworks — Francesco D'Isa</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .series-block {
      margin-bottom: clamp(3rem, 7vw, 6rem);
    }
    .series-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .series-title {
      font-family: var(--serif);
      font-weight: 300;
      font-size: clamp(1.3rem, 3vw, 2rem);
      letter-spacing: -0.01em;
      margin-bottom: 0.6rem;
    }
    .series-description {
      font-family: var(--serif);
      font-size: 1.05rem;
      line-height: 1.7;
      color: #555;
      max-width: 680px;
    }

    /* Griglia: auto-fit fa collassare le celle vuote */
    .artworks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1px;
      background: var(--border);
    }
    /* Se le opere sono poche, non stretchiamo su tutta la larghezza */
    .artworks-grid.few {
      display: flex;
      flex-wrap: wrap;
      gap: 1px;
      background: transparent;
    }
    .artworks-grid.few .artwork-item {
      width: calc(25% - 1px);
      min-width: 180px;
      flex-shrink: 0;
    }

    .artwork-item {
      background: var(--bg);
      cursor: zoom-in;
      overflow: hidden;
    }
    .artwork-thumb {
      width: 100%;
      aspect-ratio: 1 / 1;
      overflow: hidden;
      position: relative;
      background: #EDEAE5;
    }
    .artwork-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.5s ease;
    }
    .artwork-item:hover .artwork-thumb img {
      transform: scale(1.04);
    }
    .video-thumb-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.18);
      transition: background 0.3s;
    }
    .artwork-item:hover .video-thumb-overlay {
      background: rgba(0,0,0,0.08);
    }
    .play-icon {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: rgba(248,246,242,0.9);
      display: flex; align-items: center; justify-content: center;
    }
    .play-icon::after {
      content: '';
      display: block;
      width: 0; height: 0;
      border-style: solid;
      border-width: 8px 0 8px 16px;
      border-color: transparent transparent transparent #111110;
      margin-left: 3px;
    }
    .artwork-caption {
      padding: 0.75rem 1rem 0.9rem;
      border-top: 1px solid var(--border);
    }
    .artwork-caption h3 {
      font-family: var(--serif);
      font-weight: 400;
      font-size: 1rem;
      line-height: 1.2;
    }
    .artwork-caption span {
      font-size: 0.72rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }

    /* Lightbox */
    .lightbox { flex-direction: column; gap: 1rem; }
    .lightbox img { max-width: 90vw; max-height: 80vh; object-fit: contain; }
    .lb-video { width: min(90vw, 900px); aspect-ratio: 16/9; }
    .lb-video iframe { width: 100%; height: 100%; border: none; }
    .lb-caption {
      color: rgba(248,246,242,0.55);
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-inner">
      <a class="nav-logo" href="index.html">Francesco D'Isa</a>
      <button class="nav-toggle" aria-label="Menu"><span></span><span></span><span></span></button>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="artworks.html">Artworks</a></li>
        <li><a href="books.html">Books</a></li>
        <li><a href="articles.html">Articles</a></li>
        <li><a href="https://www.youtube.com/@francescodisa" target="_blank" rel="noopener">Videos</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <div class="container">
      <header class="page-header"><h1>Artworks</h1></header>
      <div id="artworks-root">
        <p style="color:var(--muted);font-size:.85rem;letter-spacing:.08em;text-transform:uppercase">Caricamento…</p>
      </div>
    </div>
  </main>

  <div id="lightbox" class="lightbox" role="dialog">
    <button class="lightbox-close" aria-label="Chiudi">✕</button>
    <img src="" alt="" id="lb-img" style="display:none" />
    <div class="lb-video" id="lb-video" style="display:none">
      <iframe id="lb-iframe" src="" allowfullscreen
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
    </div>
    <p class="lb-caption" id="lb-caption"></p>
  </div>

  <footer>
    <div class="footer-inner">
      <small>© <span id="yr"></span> Francesco D'Isa</small>
      <ul class="footer-links">
        <li><a href="about.html">Contact</a></li>
        <li><a href="https://www.youtube.com/@francescodisa" target="_blank" rel="noopener">YouTube</a></li>
      </ul>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    function youtubeId(url) {
      if (!url) return null;
      const m = url.match(/(?:v=|youtu\.be\/)([A-Za-z0-9_-]{11})/);
      return m ? m[1] : null;
    }

    const lb       = document.getElementById('lightbox');
    const lbImg    = document.getElementById('lb-img');
    const lbVideo  = document.getElementById('lb-video');
    const lbIframe = document.getElementById('lb-iframe');
    const lbCap    = document.getElementById('lb-caption');

    function openLightbox(op) {
      const vid = youtubeId(op.youtube);
      if (vid) {
        lbImg.style.display   = 'none';
        lbVideo.style.display = 'block';
        lbIframe.src = `https://www.youtube.com/embed/${vid}?autoplay=1`;
      } else {
        lbVideo.style.display = 'none';
        lbIframe.src = '';
        lbImg.style.display = 'block';
        lbImg.src = op.image || '';
      }
      lbCap.textContent = [op.title, op.year, op.medium].filter(Boolean).join(' — ');
      lb.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lb.classList.remove('open');
      document.body.style.overflow = '';
      lbIframe.src = '';
      lbImg.src = '';
    }

    lb.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
    lb.addEventListener('click', e => { if (e.target === lb) closeLightbox(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

    fetch('data/artworks.json').then(r => r.json()).then(data => {
      const root   = document.getElementById('artworks-root');
      const series = data.series || [];

      if (!series.length || !series.some(s => s.items && s.items.length)) {
        root.innerHTML = '<p style="color:var(--muted);font-size:.85rem;letter-spacing:.08em;text-transform:uppercase">Nessuna opera ancora.</p>';
        return;
      }

      root.innerHTML = series.map(serie => {
        if (!serie.items || !serie.items.length) return '';

        const titleHtml = serie.title
          ? `<h2 class="series-title">${serie.title}</h2>` : '';
        const descHtml = serie.description
          ? `<p class="series-description">${serie.description}</p>` : '';
        const headerHtml = (titleHtml || descHtml)
          ? `<div class="series-header">${titleHtml}${descHtml}</div>` : '';

        /* se le opere sono meno di 4 usiamo flex per evitare stretch */
        const gridClass = serie.items.length < 4 ? 'artworks-grid few' : 'artworks-grid';

        const grid = `<div class="${gridClass}">
          ${serie.items.map(op => {
            const vid = youtubeId(op.youtube);
            const thumb = vid
              ? `<img src="https://img.youtube.com/vi/${vid}/maxresdefault.jpg"
                      alt="${op.title}" loading="lazy"
                      onerror="this.src='https://img.youtube.com/vi/${vid}/hqdefault.jpg'" />
                 <div class="video-thumb-overlay"><div class="play-icon"></div></div>`
              : `<img src="${op.image || ''}" alt="${op.title}" loading="lazy" />`;
            return `<div class="artwork-item fade-in">
              <div class="artwork-thumb">${thumb}</div>
              <div class="artwork-caption">
                <h3>${op.title}</h3>
                <span>${[op.year, op.medium].filter(Boolean).join(' — ')}</span>
              </div>
            </div>`;
          }).join('')}
        </div>`;

        return `<div class="series-block">${headerHtml}${grid}</div>`;
      }).join('');

      setTimeout(() => document.querySelectorAll('.fade-in').forEach(el => el.classList.add('visible')), 50);

      const allOps = series.flatMap(s => s.items || []);
      root.querySelectorAll('.artwork-item').forEach((el, i) => {
        el.addEventListener('click', () => openLightbox(allOps[i]));
      });

    }).catch(() => {
      document.getElementById('artworks-root').innerHTML =
        '<p style="color:var(--muted)">Errore nel caricamento.</p>';
    });
  </script>
</body>
</html>
